% Running through function calls in SOSTOOL Book
clc

% Flags for switching on and off pre and post processing
preproc = input('Preprocessing (0 = off, 1 = on):');

% Ensuring correct input set
while (preproc ~= 1) && (preproc ~= 0)
    disp('Please use valid input')
    preproc = input('Preprocessing (0 = off, 1 = on):');
end;

postproc = input('Postprocessing (0 = off, 1 = on):');

% Ensuring correct input set
while (postproc ~= 1) && (postproc ~= 0)
    disp('Please use valid input')
    postproc = input('Postprocessing (0 = off, 1 = on):');
end;

% Following (https://yalmip.github.io/tutorial/sumofsquaresprogramming/)
x = sdpvar(1,1); % defines Yalmips symbolic decision vars
y = sdpvar(1,1);
w = sdpvar(1,1); 
z = sdpvar(1,1);

% % Stanford slides, slide 6 example
% p1 = 4*x^4 + 4*(x^3)*y - 7*(x^2)*(y^2) - 2*x*(y^3) + 10*y^4;
% 
% % Calculates and outputs decomp
% F = sos(p1);
% solvesos(F);
% h1 = sosd(F);
% 
% % Stanford slides, slide 10 example
% p2 = 2*x^4 + 2*(x^3)*y - (x^2)*(y^2) + 5*y^4;
% 
% % Calculates and outputs decomp
% F = sos(p2);
% solvesos(F);
% h2 = sosd(F);

% Testing FP accuracy with expression on slide 21
% p3 = 4.5819*x^2 - 1.5786*x*y + 1.7834*(y^2) - 0.12739*(x^3) + 2.5189*(x^2)*y - ...
%     0.34069*x*(y^2) + 0.61188*(y^3) + 0.47537*(x^4) - 0.052424*(x^3)*y + ...
%     0.44289*(x^2)*(y^2) + 0.0000018868*x*(y^3) + 0.090723*y^4;

% Testing massive function at the bottom of this page:
% https://yalmip.github.io/example/moresos/
p = 8*x^6*w^6*y^2+4*z^4*y^8*x^2+4*z^4*y^4*x^4+8*z^4*y^6*x^2+...
4*x^8*w^6*y^2+4*z^4*y^4*x^2+4*z^6*y^8*x^2+8*y^2*x^6*w^4+...
4*x^4*y^4*w^4-2*x^6*y^6-16*z^4*y^4*x^4*w^2-16*z^4*y^4*x^2*w^4-...
20*z^4*y^4*x^6*w^2-24*z^4*y^4*x^6*w^4+12*z^4*y^6*x^2*w^2-...
8*z^4*y^6*x^2*w^4+4*z^4*y^6*x^4*w^2-24*z^4*y^6*x^4*w^4-...
16*z^4*y^6*x^6*w^2-40*z^4*y^4*x^4*w^4-4*z^4*y^2*x^2*w^2-...
8*z^4*y^2*x^2*w^4-12*z^4*y^2*x^4*w^2-16*z^4*y^2*x^4*w^4-...
12*z^4*y^2*x^6*w^2-8*z^4*y^2*x^6*w^4-4*z^4*y^2*x^8*w^2-...
16*z^4*y^6*x^6*w^4+8*z^4*y^8*x^2*w^2+12*z^4*y^8*x^4*w^2-...
6*y^2*x^6*z^2*w^2-2*y^2*x^8*z^2*w^2-14*x^4*y^4*z^2*w^2-...
6*x^2*y^4*z^2*w^2-6*x^4*y^2*z^2*w^2-6*x^2*y^6*z^2*w^2-...
10*x^4*y^6*z^2*w^2-10*y^4*x^6*z^2*w^2-2*x^2*y^8*z^2*w^2-...
20*x^6*y^6*z^2*w^2+6*y^4*x^8*z^2*w^2+6*x^4*y^8*z^2*w^2+...
12*z^2*w^4*y^2*x^6-12*z^2*w^4*x^2*y^4-16*z^2*w^4*x^4*y^4+...
4*z^2*w^4*x^6*y^4-12*z^2*w^4*x^2*y^6-20*z^2*w^4*x^4*y^6+...
8*z^2*w^4*x^8*y^2+4*x^4*y^2*w^4+x^4*w^4+2*x^6*w^4+x^8*w^4+...
z^4*y^4+2*z^4*y^6+z^4*y^8+x^8*y^4+x^4*y^8+8*x^6*y^4*w^4+4*x^8*y^2*w^4+...
8*z^4*y^6*x^4+6*z^4*y^8*x^4-4*z^4*y^6*x^6+2*z^4*y^4*x^8+...
3*z^4*y^4*w^2+2*z^4*y^4*w^4+6*z^4*y^6*w^2+4*z^4*y^6*w^4+...
3*z^4*y^8*w^2+2*z^4*y^8*w^4-6*x^6*y^6*z^2+3*y^4*x^8*z^2+...
3*x^4*y^8*z^2-6*x^6*y^6*w^2+3*x^8*y^4*w^2+3*x^4*y^8*w^2+...
3*z^2*w^4*x^4+6*z^2*w^4*x^6+3*z^2*w^4*x^8+2*z^4*w^4*x^4+...
4*z^4*w^4*x^6+2*z^4*w^4*x^8-16*z^2*w^4*x^6*y^6-4*z^2*w^4*x^2*y^8+...
12*z^2*w^4*x^8*y^4-4*x^2*w^4*y^2*z^2-2*x^2*y^2*z^2*w^2+...
8*x^8*y^4*z^2*w^6-4*x^6*w^4*y^6+6*x^8*w^4*y^4+2*x^4*w^4*y^8+...
2*x^4*z^2*w^6+2*y^4*z^6*w^2+y^4*z^6+x^4*w^6+2*y^6*z^6+4*x^4*y^8*z^6+...
4*x^8*y^4*w^6+4*x^2*y^4*z^6+8*x^2*y^6*z^6+4*x^4*y^4*z^6+...
2*y^8*z^6*w^2+8*x^6*w^6*y^4+4*x^4*w^6*y^2+4*x^4*w^6*y^4+...
2*x^8*w^6*z^2+8*x^4*y^8*z^6*w^2+8*x^2*y^4*z^6*w^2+16*x^2*y^6*z^6*w^2+...
8*x^4*y^4*z^6*w^2+16*x^6*w^6*y^4*z^2+8*x^8*w^6*y^2*z^2+...
8*x^4*w^6*y^4*z^2+8*x^4*w^6*y^2*z^2+16*x^6*w^6*y^2*z^2+...
y^8*z^6+2*x^6*w^6+x^8*w^6+4*x^6*w^6*z^2+16*x^4*y^6*z^6*w^2+...
8*z^6*y^6*x^4+4*z^6*y^6*w^2+8*x^2*y^8*z^6*w^2;

% Setting preprocessing parameters
if preproc
    options = sdpsettings('sos.newton',1,'sos.congruence',1);
else
    options = sdpsettings('sos.newton',0,'sos.congruence',0);
end

% Setting postprocessing parameters
if preproc
    options = sdpsettings('sos.numblkdg',1e-6);
end

% Calculates and outputs decomp
F = sos(p);
solvesos(F, [], options)
h = sosd(F);

fprintf("Calculation of p - h'*h to determine accuracy of SOS decomp:\n\n")

fprintf("Complex function:\n")
p-h'*h
% fprintf("\nStanford slides; slide 10 example:\n")
% p2-h2'*h2
% fprintf("\nNo pre-processing, Stanford slides; slide 21 example:\n")
% p3-h3_1'*h3_1
% fprintf("\nPre-processing enabled, Stanford slides; slide 21 example:\n")
% p3-h3_2'*h3_2